<html>
  <head>
    <title>Oddjob Reference - script</title>
  </head>
  <body>
  [<a href="../../../index.html">Index</a>]
    <h1>script</h1>
    <hr/>
Execute a script. The script can be in any 
 language that supports the Java Scripting Framework.
 <p>
 The named beans property allow values to be passed to and from the
 script.
 <p>
    <hr/>
    <h3>Property Summary</h3>
    <table width='100%' border='1' cellpadding='3' cellspacing='0'>
    <tr>
      <td><a href='#property1'>beans</a></td>
      <td>A named bean which is made available to
 the script.</td>
    </tr>
    <tr>
      <td><a href='#property2'>classLoader</a></td>
      <td>ClassLoader to load the Script Engine.</td>
    </tr>
    <tr>
      <td><a href='#property3'>input</a></td>
      <td>The script provided as input from file or buffer etc.</td>
    </tr>
    <tr>
      <td><a href='#property4'>invocable</a></td>
      <td>Allow a scripted function to be evaluated 
 from elsewhere in Oddjob.</td>
    </tr>
    <tr>
      <td><a href='#property5'>language</a></td>
      <td>The name of the language the script 
 is in.</td>
    </tr>
    <tr>
      <td><a href='#property6'>name</a></td>
      <td>A name, can be any text.</td>
    </tr>
    <tr>
      <td><a href='#property7'>result</a></td>
      <td>The result of executing the script or the script
 variable chosen as the result variable with the resultVariable
 property.</td>
    </tr>
    <tr>
      <td><a href='#property8'>resultForState</a></td>
      <td>If true then use the result to determine the 
 completion state of the job.</td>
    </tr>
    <tr>
      <td><a href='#property9'>resultVariable</a></td>
      <td>The variable in the script that will be used to 
 provide the result.</td>
    </tr>
    <tr>
      <td><a href='#property10'>stop</a></td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><a href='#property11'>variables</a></td>
      <td>Provide access to variables declared within the
 script.</td>
    </tr>
    </table>
    <hr/>
    <h3>Example Summary</h3>
    <table width='100%' border='1' cellpadding='3' cellspacing='0'>
    <tr>
      <td><a href='#example1'>Example 1</a></td>
      <td>Hello World.</td>
    </tr>
    <tr>
      <td><a href='#example2'>Example 2</a></td>
      <td>Variables from and to Oddjob.</td>
    </tr>
    <tr>
      <td><a href='#example3'>Example 3</a></td>
      <td>Using a script to set a property on a Job elsewhere in Oddjob.</td>
    </tr>
    <tr>
      <td><a href='#example4'>Example 4</a></td>
      <td>Invoking a script to provide a substring function.</td>
    </tr>
    <tr>
      <td><a href='#example5'>Example 5</a></td>
      <td>Setting the script job to not complete.</td>
    </tr>
    </table>
    <hr/>
    <h3>Property Detail</h3>
    <a name='property1'><h4>beans</h4></a>
      <table style='font-size:smaller'>
      <tr><td><i>Configured By</i></td><td>ELEMENT</td></tr>
      <tr><td><i>Access</i></td><td>READ_WRITE</td></tr>
      <tr><td><i>Required</i></td><td>No.</td></tr>
      </table>
      <p>
A named bean which is made available to
 the script.
      </p>
    <a name='property2'><h4>classLoader</h4></a>
      <table style='font-size:smaller'>
      <tr><td><i>Configured By</i></td><td>ELEMENT</td></tr>
      <tr><td><i>Access</i></td><td>READ_WRITE</td></tr>
      <tr><td><i>Required</i></td><td>No. Automatically set to the current Oddjob class loader.</td></tr>
      </table>
      <p>
ClassLoader to load the Script Engine.
      </p>
    <a name='property3'><h4>input</h4></a>
      <table style='font-size:smaller'>
      <tr><td><i>Configured By</i></td><td>ELEMENT</td></tr>
      <tr><td><i>Access</i></td><td>READ_WRITE</td></tr>
      <tr><td><i>Required</i></td><td>Yes.</td></tr>
      </table>
      <p>
The script provided as input from file or buffer etc.
      </p>
    <a name='property4'><h4>invocable</h4></a>
      <table style='font-size:smaller'>
      <tr><td><i>Access</i></td><td>READ_ONLY</td></tr>
      </table>
      <p>
Allow a scripted function to be evaluated 
 from elsewhere in Oddjob.
      </p>
    <a name='property5'><h4>language</h4></a>
      <table style='font-size:smaller'>
      <tr><td><i>Configured By</i></td><td>ATTRIBUTE</td></tr>
      <tr><td><i>Access</i></td><td>READ_WRITE</td></tr>
      <tr><td><i>Required</i></td><td>No. Defaults to JavaScript.</td></tr>
      </table>
      <p>
The name of the language the script 
 is in.
      </p>
    <a name='property6'><h4>name</h4></a>
      <table style='font-size:smaller'>
      <tr><td><i>Configured By</i></td><td>ATTRIBUTE</td></tr>
      <tr><td><i>Access</i></td><td>READ_WRITE</td></tr>
      <tr><td><i>Required</i></td><td>No.</td></tr>
      </table>
      <p>
A name, can be any text.
      </p>
    <a name='property7'><h4>result</h4></a>
      <table style='font-size:smaller'>
      <tr><td><i>Access</i></td><td>READ_ONLY</td></tr>
      </table>
      <p>
The result of executing the script or the script
 variable chosen as the result variable with the resultVariable
 property.
      </p>
    <a name='property8'><h4>resultForState</h4></a>
      <table style='font-size:smaller'>
      <tr><td><i>Configured By</i></td><td>ATTRIBUTE</td></tr>
      <tr><td><i>Access</i></td><td>READ_WRITE</td></tr>
      <tr><td><i>Required</i></td><td>No, defaults to false.</td></tr>
      </table>
      <p>
If true then use the result to determine the 
 completion state of the job. If the result is not a number this 
 property will have no affect. 
 If the result is a number and 0 the job will COMPLETE, any
 other value and the job will be INCOMPLETE.
      </p>
    <a name='property9'><h4>resultVariable</h4></a>
      <table style='font-size:smaller'>
      <tr><td><i>Configured By</i></td><td>ATTRIBUTE</td></tr>
      <tr><td><i>Access</i></td><td>READ_WRITE</td></tr>
      <tr><td><i>Required</i></td><td>No.</td></tr>
      </table>
      <p>
The variable in the script that will be used to 
 provide the result. The property is designed for use with scripting
 languages who's execution does not produce a result. If, however 
 the script does produce a result and this property is set, the variable
 will override the scripts return value.
      </p>
    <a name='property10'><h4>stop</h4></a>
      <table style='font-size:smaller'>
      <tr><td><i>Access</i></td><td>READ_ONLY</td></tr>
      <tr><td><i>Required</i></td><td>Read Only.</td></tr>
      </table>
      <p>

      </p>
    <a name='property11'><h4>variables</h4></a>
      <table style='font-size:smaller'>
      <tr><td><i>Access</i></td><td>READ_ONLY</td></tr>
      </table>
      <p>
Provide access to variables declared within the
 script.
      </p>
    <hr/>
    <h3>Examples</h3>
    <a name='example1'><h4>Example 1</h4></a>
    <p>
Hello World.
 
 <pre class="xml">
&lt;oddjob&gt;
    &lt;job&gt;
        &lt;script id="s" language="JavaScript"&gt;
            &lt;input&gt;
                &lt;buffer&gt;print ("hello world\n");&lt;/buffer&gt;
            &lt;/input&gt;
        &lt;/script&gt;
    &lt;/job&gt;
&lt;/oddjob&gt;</pre>

    </p>
    <a name='example2'><h4>Example 2</h4></a>
    <p>
Variables from and to Oddjob.
 
 <pre class="xml">
&lt;oddjob&gt;
 &lt;job&gt; 
 &lt;sequential&gt;
 &lt;jobs&gt;
  &lt;script id="s" language="JavaScript"&gt;
   &lt;input&gt;
    &lt;buffer&gt;
var snack = fruit;
    &lt;/buffer&gt;
   &lt;/input&gt;
   &lt;beans&gt;
    &lt;value key="fruit" value="apple"/&gt;
   &lt;/beans&gt;
  &lt;/script&gt;
  &lt;echo id="e"&gt;${s.variables(fruit)}&lt;/echo&gt;
 &lt;/jobs&gt;
 &lt;/sequential&gt;
 &lt;/job&gt; 
&lt;/oddjob&gt;</pre>

    </p>
    <a name='example3'><h4>Example 3</h4></a>
    <p>
Using a script to set a property on a Job elsewhere in Oddjob.
 
 <pre class="xml">
&lt;oddjob&gt;
 &lt;job&gt;
  &lt;sequential&gt;
   &lt;jobs&gt;
    &lt;script id="s" language="JavaScript"&gt;
     &lt;input&gt;
      &lt;buffer&gt;
vars.set('today', new java.util.Date());
      &lt;/buffer&gt;
     &lt;/input&gt;
     &lt;beans&gt;
      &lt;value key="vars" value="${v}"/&gt;
     &lt;/beans&gt;
    &lt;/script&gt;
    &lt;variables id="v"&gt;
     &lt;formattedToday&gt;
      &lt;format date="${v.today}" format="yyyyMMdd"/&gt;
     &lt;/formattedToday&gt;
    &lt;/variables&gt;
   &lt;/jobs&gt;
  &lt;/sequential&gt;
 &lt;/job&gt;
&lt;/oddjob&gt;</pre>

    </p>
    <a name='example4'><h4>Example 4</h4></a>
    <p>
Invoking a script to provide a substring function.
 
 <pre class="xml">
&lt;oddjob&gt;
    &lt;job&gt;
        &lt;sequential&gt;
            &lt;jobs&gt;
                &lt;script id="substr" language="JavaScript"&gt;
                    &lt;input&gt;
                        &lt;buffer&gt;function substr(string, from, to) {
    return string.substring(from, to);
}&lt;/buffer&gt;
                    &lt;/input&gt;
                &lt;/script&gt;
                &lt;properties id="properties"&gt;
                    &lt;values&gt;
                        &lt;value key="text.before" value="Apples and Oranges"/&gt;
                        &lt;invoke function="substr" key="text.after"&gt;
                            &lt;parameters&gt;
                                &lt;value value="${text.before}"/&gt;
                                &lt;value value="0"/&gt;
                                &lt;value value="6"/&gt;
                            &lt;/parameters&gt;
                            &lt;source&gt;
                                &lt;value value="${substr.invocable}"/&gt;
                            &lt;/source&gt;
                        &lt;/invoke&gt;
                    &lt;/values&gt;
                &lt;/properties&gt;
            &lt;/jobs&gt;
        &lt;/sequential&gt;
    &lt;/job&gt;
&lt;/oddjob&gt;</pre>

    </p>
    <a name='example5'><h4>Example 5</h4></a>
    <p>
Setting the script job to not complete. 
 
 <pre class="xml">
&lt;oddjob&gt;
  &lt;job&gt;
    &lt;script language="JavaScript" resultVariable="result" resultForState="true"&gt;
      &lt;input&gt;
        &lt;buffer&gt;
var result = 1;
        &lt;/buffer&gt;
      &lt;/input&gt;
    &lt;/script&gt;
  &lt;/job&gt;
&lt;/oddjob&gt;</pre>

    </p>
    <hr/>
    <font size='-1' align='center'>(c) Rob Gordon 2005 - 2014</font>
	 </body>
  </html>
